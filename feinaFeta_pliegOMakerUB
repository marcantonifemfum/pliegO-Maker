DESCRIPCIÓ DE FEINA FETA

    21.10.2024
- - - - - - - -

#1    Anàlisi dels PDFs a imposar:
#    1 >> RI: FemFum_CaLi2CoPi_042_*.ps / farceixPDFs_pseudoPDFX5_ReferenceXObjects_EnricSenabre.ps
#    AR: #4h
#    EC: #16h

+ tant a Tuxedo (/home/femfum/Documents/pliegOMakerU / localhost /var/www/html/pliegOMakerUB) com a somNúvol (?) treballem amb GPL Ghostscript 9.55.0 (2021-09-27)
+ etiquetem amb %%UBpliegOMaker els canvis i novetats de codi en els algorismes que ja tenim desenvolupats

#    1.1 ~ Detecció de PDFs erronis, protegits per encriptació i signats digitalment, determinant el tipus de missatge que donarem a l'ususari per continuar treballant

%%H: de 9h00 a 10h00
%%H: de 11h00 a 13h15
%%H: de 13h45 a 14h15
%%H: de 22h00 a 22h45
%%HT 4.50h

+ línia de comanda Cali2CoPi_042 (reanomenat amb la cua _pliegOMakerUBESH) Tuxedo:
+ gs -q -dNOSAFER -o re.pdf -sDEVICE=pdfwrite -f FemFum_CaLi2CoPi_042_pliegOMakerUBESH.ps

+ configurat CaLi2CoPi per executar-se visa prompt del Tuxedo
+ un cop ha fet anàlisi repica el fitxer original en un nou fitxer al mteix lloc i que es diu igual però amb l'afegit… _pla

+ a l'execució via Terminal cal advertir que s'ha de ser curós amb els noms dels fitxers PDF/TXT a processar, per no tenir problemes amb el caràcters fora de l'ascii, alguns signes reservat (* ?) i l'espai en blanc

+ deixem intacte, per ara, la detecció fitxers signats digitalment (ídem REpublica), p.e.
+ (gatell CaLi2CoPi 16) MRCT6 Aquest PDF duu Signatura Digital

+ gatells GS específics d'encriptació:
+ The following switches are used for creating encrypted documents:

+ -sOwnerPassword=string
+    Defines that the document be encrypted with the specified owner password.

+ -sUserPassword=string
+    Defines the user password for opening the document. If empty, the document can be opened with no password, but the owner password is required to edit it.

+ -dPermissions=number
+    Defines the PDF permissions flag field. Negative values are allowed to represent unsigned integers with the highest bit set. See the PDF Reference manual for the meaning of the flag bits.

+ -dEncryptionR=number
+    Defines the encryption method revision number - either 2 or 3.

+ -dKeyLength=number
+    Defines the length (in bits) of the encryption key. Must be a multiple of 8 in the interval [40, 128]. If the length isn’t 40, -dEncryptionR must be 3.

+ deixem intacte, per ara, la detecció fitxers encriptats (ídem REpublica), p.e. encriptatAEIOUSenzill_obertura_aeiou.pdf | encriptatAEIOUSenzill.pdf
+ (gatell CaLi2CoPi 11) MRCT4  Aquest PDF és Encriptat
+ (gatell CaLi2CoPi ) MRCT9 Aquest PDF ha estat desencriptat per un Crack

+ gatell GS genèric per tractar un PDF encriptat?
+ -sPDFPassword= "?"

+ creat el fitxer… PDFencriptatSenzill.ps …per veure com generem PDFs amb diferents tipus d'encriptació

+ altres errors que CaLi2Copi detecta i que marquem al codi amb %%UBpliegOMaker:
+ (gatell CaLi2CoPi 4) MRCT2  Error de Sintaxi al Path del PDF a tractar
+ (gatell CaLi2CoPi 8) MRCT3  Estructura de Fitxer No Suportada per CaLi2CoPi\n ... objecte malmès ...
+ (gatell CaLi2CoPi 13) MRCT5 Teniu un Error a la capçalera de dades de CaLi2CoPi
+ ATENCIÓ tenim documentat en aquest error (BaBeL 8 get en un if no actiu) un mètode de control/lectura d'errors que més endavant ens pot interessar
+ (gatell CaLi2CoPi 18) MRCT8 Error d'estructura: PDF sense l'arrel /Pages
+ (gatell CaLi2CoPi 22) MRCT19 Aquesta plana no duu /Contents
+ (gatell CaLi2CoPi 26) MRCT13 Cap del PDF erroni
+ (gatell CaLi2CoPi 27) MRCT14 Cap del PDF amb brossa
+ (gatell CaLi2CoPi 28) MRCT15 Cua de PDF erronia
+ (gatell CaLi2CoPi 29) MRCT16 Cua de PDF amb brossa
+ (gatell CaLi2CoPi 32) MRCT18 Stream sense l'entrada /Length
+ (gatell CaLi2CoPi 33) MRCT20 Aquesta pagina no duu /Resources
+ (gatell CaLi2CoPi 35) MRCT21 Aquesta imatge XObject duu l'stream buit
+ (gatell CaLi2CoPi 39) MRCT23 Aquest objecte duu una clau /Length erronia i no suportada
+ (gatell CaLi2CoPi 41) MRCT24 ERROR inLine: hem exhaurit la capacitat permesa per una inLine i ens hem menjat les dades sens trobar el final correcte!
+ (gatell CaLi2CoPi 42) MRCT25 ERROR inLine: ens hem menjat les dades sens trobar el final correcte!

+ avisos importants:
+ (gatell CaLi2CoPi 8) Desfem el Fast Web View
+ (gatell CaLi2CoPi 17) MRCT7 Aquest PDF duu la compressió 1.5 Object Stream (desemboliquem automàticament el PDF per ser tractat sense aquesta compressió)
+ (gatell CaLi2CoPi 38) MRCT22 Aquest document te mes d'una (1) pagina (genera un error fent la separació de tintes però el podem fer servir a pliegOS)
+ (gatell CaLi2CoPi 43) ... Aquesta pagina no duu text, podria complementar a 1.4 quan fem l'anàlisi de pàgines

+ estratègies possibles:
+ (gatell CaLi2CoPi 31 | MRCT17 Errors a XRay) hi ha el gatell /XRayError (utilitzat pel projecte WebProof/TetraBrik) que ens permet filtrar errors més en diferit a través del TXT que emmagatzema dades diverses del PDF
+ hi ha el gatell 17 ENCAVALCA CONTINGUTS (línia 32591) on ja hi han resolts diversos mètodes comparatius del /MediaBox amb el /CropBox útils per a 1.3
+ cal veure si el gatell 17 també podria servir per a fer funcions d'imposar pàgines tal i com ara fem amb el PDF scripting
+ cal plantejar-se tenir una opció que CaLi2CoPi NO reescrigui de nou el PDF (sobretot en fitxers molt grans) doncs al pliegO'Maker, per segons quines característiques/opcions que haguem analitzat/triat, no li faria falta (el comportament de /CropBox és crític per això)
+ tampoc no és estrictament necessari escriure el fitxer d'anàlisi XRay
+ cal fer valoracions de temps d'execució de CaLi2CoPi jugant amb l'operador… vmthreshold …doncs per exemple el replicat (gatell 0) del manual de PDF 1.7 (pdfreference1.7old.pdf 1310 pàgs 31MB) triga més de mitja hora (Tuxedo Aura 13) a processar-se
+ cal valorar quines estratègies d'avís (CropBox, signatures, encriptats, anotacions, bookmarks, capes, etc.) podem fer servir segons s'executi via Terminal o via web: via prompt (apunt) al Terminal, via apunt (prompt) JS alert(); o via TXT (XRay) o via .log doncs hi ha una crida específica de GS que l'escriu
+ cal definir quines noves opcions de menú hem d'afegir %MENU% dins l'àmbit de l'anàlisi/repicat que ens fa CaLi2CoPi i com les jerarquitzem dins el menú minimalista en TXT i/o usabilitat web de la interfície


    22.10.2024
- - - - - - - -

%%H: de 07h45 a 08h15
%%H: de 09h00 a 12h30
%%H: de 18h15 a 20h30
%%H: de 21h00 a 21h30
%%HT 6.75h

#    1.2 ~ Detecció de PDFs amb anotacions, bookmarks i capes, determinant el tipus de missatge que donarem a l'ususari per continuar treballant

+ què passa quan passem a pliegOS un PDF amb capes?
+ segons el comportament que veiem amb PDFs que tinguin capes un cop passat a pliegOS, tenim el gatell 15 ELIMINA LLEIXES
+ tenim l'exemple… OJUmesD9milCapes.pdf (té 915 pàgines) …que a l'executar el procés amb:
gs -q -dNOSAFER -o re.pdf -sDEVICE=pdfwrite -f nUp_pliegOS_UBESH.ps …veiem que s'eliminen les capes
+ com que al passar per pliegOS s'eliminen les capes, hauríem d'avisar, si el PDF en té, que desapareixeran

+ què passa quan passem a pliegOS un PDF amb anotacions?
+ fem… fa8paginesAmbAnotacions.ps …per generar exemples amb anotacions… 8paginesAmbAnotacions.pdf …de cara a detectar-les i veure què passa amb pliegOS
+ CaLi2CoPi detecta les anotacions en general (clau /Annots a cada diccionari /Page) en un petit algorisme del gatell 16 (cerca i substitució de text)
+ vegeu línia aprox 69405 però que hauríem de traslladar al principi de l'anàlisi al gatell que assignem a UBESH
+ com que les anotacions es conserven a cada pàgina imposada, hauríem d'avisar, si el PDF en té i decidir si es volen eliminar %MENU%

+ què passa quan passem a pliegOS un PDF amb bookmarks?
+ el gatell 8 de CaLi2CoPi analitza l'exitència de bookmarks (/Outlines a /Catalog) traduït com a CONTINGUT en català (Okular)
+ els bookmarks es conserven intactes fent un pliegOS, però llavors es perden completament els vincles doncs la distribució de les pàgines imposades dins les planes PDF no tenen res a veure amb el PDF d'origen. Exemple… 4upDeComSarrosseguenTOTSelsBookmarksD1OriginalD1310paginesA1D2.pdf %MENU%

+ posada en marxa de pliegOS per ser executat al Terminal
+ 1 ~ descarreguem del Git REpublica: nUp_pliegOS_plec.ps i el reanomenem nUp_pliegOS_UBESH.ps
+ 2 ~ descarreguem del Git REpublica: farceixPDFs_pseudoPDFX5_REpublica.ps i el reanomenem farceixPDFs_pseudoPDFX5_UBESH.ps
+ 3 ~ descarreguem del Git REpublica: FemFum_CaLi2CoPi_042_REpublica.ps i el reanomenem FemFum_CaLi2CoPi_042_pliegOMakerUBESH.ps
+ 4 ~ actualitzem tots els path de treball i els marquem amb %%URLUBESH també els punts potencials de modificació amb %%UBESH
+ 5 ~ la línia de comanda des del directori de treball del Terminal… /home/femfum/Documents/pliegOMakerUB …és:
gs -q -dNOSAFER -o re.pdf -sDEVICE=pdfwrite -f nUp_pliegOS_UBESH.ps
+ 6 ~ a… farceixPDFs_pseudoPDFX5_UBESH.ps …mantenim l'estratègia de separar el nom de fitxer PDF a tractar amb el path absolut fix on hi posarem aquests PDFs %MENU% en paral·lel a l'estratègia seguida treballant via web. Al Tuxedo… /home/femfum/Documents/pliegOMakerUB/Hpdf/
+ 7 ~ en canvi on volem que s'escrigui el fitxer PDF imposat, resultat del pliegO'Maker, i el seu nom, només dependrà de com escrivim la línia de comanda al Terminal… gs -q -dNOSAFER -o pliegOSimposat.pdf -sDEVICE=pdfwrite -f nUp_pliegOS_UBESH.ps

+ operacions amb PDFs via línia de comanda GS:
+ sumar PDFs un darrera l'altre (si porta capes se les poleix!) gs -q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile=aimposarambcapes.pdf 21700154803_cubDeNoordzij.pdf 21700154803_cubDeNoordzij.pdf 21700154803_cubDeNoordzij.pdf


    23.10.2024
- - - - - - - -

%%H: de 11h45 a 13h15
%%H: de 13h45 a 14h45
%%H: de 16h00 a 18h00
%%H: de 21h00 a 22h00
%%HT 5.50h

#    1.3 ~ Detecció d'àrees de retall de pàgines (CropBox), determinant prèviament de com les tractarem: sigui per eliminar-les (interfereixen l'algorisme pristí) o sigui per adaptar el retall a la pàgina del llançat

+ experimentem amb l'exemple… 8CropBox.pdf …on cadascuna de les 8 pàgines té un /CropBox activat diferent
+ com que aquí els 8 CropBox són quadrats, n'hauríem de fer un on n'hi hagués també rectangles verticals i horitzontals

+ el protocol d'anàlisi/avís seria:
+ 0 ~ el /CropBox, si existeix sempre, s'ha d'eliminar
+ 1 ~ hem d'avisar que hi ha /CropBox NOMÉS si és diferent a /MediaBox, llavors s'haurien de citar quines pàgines estan afectades
+ 2 ~ la resta d'àrees de treball (/TrimBox /BleedBox /ArtBox) creiem que, en cas d'existir, també es poden elminar directament doncs només són indicatives i podrien aparèixer (si el viewer ho permet) sense cap sentit dins el pliegOS imposat
+ 3 ~ si es vol que mani el /CropBox (afegirem una nova opció de %MENU%), d'entrada no deixarem distingir pàgines, i adaptarem la seva àrea sobre el retallador que ja activem a cadascuna de les pàgines del llançat

+ amb l'etiqueta %%Hackovid tenim les variables /iPmaker /aPmaker que ens detallen el valor, pàgina a pàgina, del MediaBox/CropBox
+ va lligat al gatell 18 de CaLi2CoPi i ens cal veure com es comporta i com ho reaprofitem:
+ 18 :: Hackovid | pliegO'Maker fa un procés parcial de l'XRay, just per capturar el MediaBox/CropBox de les pàgines i surt
+ hi ha coses del comportament a repassar: repica el PDF i cal veure perquè només escriu al /aPmaker i aPmaker.dat els CropBox
+ la clau de la comparació és al diccionari XRay /PeDeEfa get /1 get {== ==}forall on hi han [0 0 133.333328 133.333328] /CropBox [0 0 400 400] /MediaBox
+ estem veient que serà millor desactivar tot el relacionat amb %%Hackovid
+ a %%MASATSencvlct hi ha un algorisme de comparació de les arrays Media i Crop

+ hem generat l'exemple… 8CropBox_MediaBox_CropBox_NOMESaLarrelPage_pla …que defineix inextremis només Media i Crop una vegada a l'arrel /Pages
+ aquest tipus d'estructura fa fracassar la interrogació del MediaBox via PDFscripting

+ potser ens cal afegir un nou gatell /aMESaMES on modifiquem lleugerament certs comportaments del gatell principal /QueLiFemFer
+ per exemple per esborrar eficientment /CropBox sense que afecti a l'anàlisi XRay que necessitem preservar per poder replicar el CropBox via rectclip de la pàgina del llançat dins la plana d'imposició

+ afinem millor la captura d'errors dels algorismes de composició, afegint un indicador a l'stopped general de… nUp_pliegOS_UBESH.ps …que ens diu l'índex de l'algorisme componedor que estem executant

#    1.4 ~ Detecció del nombre de pàgines

+ a CaLi2CoPi la variable /maxPlana és la que emmagatzema aquest valor en tota mena de gatells
+ el valor final de /araPlana també
+ informació a afegir a les estratègies d'avís

+ a… farceixPDFs_pseudoPDFX5_UBESH.ps …també fem una crida per interrogar el nombre de pàgines del PDF a imposar:
+ Context1 .PDFInfo /NumPages get /pAimposar exch def  %% nombre de pàgines a imposar del PDF a incrustar
