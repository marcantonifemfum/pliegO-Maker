%!
%% ha de cridar tot l'estol d'algorismes d'aquest primer plegaVeu experimental
%(\n\n ...SOMM A PLEGAVEU_MESTRE!\n\n)print flush pstack quit

noNULL  %% pinta el contingut de pàgina?
{  %% comportament null: el componedor ha de tenir anellat el codi que pinta contingut de pàgina

 iSeq 1 eq  %% només 1 cop
 {

%% necessita tenir les dades: tipografia mono | cos | interliniat | compondre per 1pg/2pg/tripa | array endreçada final
%% les hem de deduir del que vingui de plegaVeu_OC.ps i de la lògica que ens cal escriure en aquesta capçalera

%%Simulem aquestes dades per:
%% Una polla xica


%% Antonina Canyelles
%% hem triat la tipo
%(/Users/femfum/calaixDtipus/Balius/TR00032-2020/Patufet/otf/Patufet-Mono-Mig-Italic.otf)

%% hem triat el cos
%% agafant la línia més llarga /aquestaEsLaLiniaMesLlarga i/o /liniaMesLlargaFa i el valor X de 2p, deduïm el cos:
%%
%595  %% /tripaX2pg4+4
%22  %% /liniaMesLlargaFa
%div
%1000 mul  %% cos mètrica Patufet-mono original
%600 div  %% ample mètrica Patufet-mono original

%dup /cosPV exch def

%% hem triat l'interliniat
%% (el valor de Y /tripaY4+4 - /cosPV) / /NlinPLANA = l'hauria de clavar
%421 cosPV sub 3 div
%dup /ilPV exch def
%(<<<<< interliniat)pstack quit

%% hem tiat el llançat (mantenim els índex de nUp: 4+4 = 4, 8+8 = 8)
%4  %%  M2

%% hem triat 0 =tripa, 1 = 1p, 2 = 2p
%2 dup /tripaVers exch def  %% índex que indica quin ample de línia (vers) triem

%% array endreçada, hem arribat a la conclusió que podem compondre a línia x vers, a 4+4, tripa a 2p i 3 pàgines 
%[
% [(Peixos dins el rostoll \n) (\340ligues dins el foc \n) (la mar dins els ulls \n)]
% [(els peus plens de cans \n) (el vent \351s pudent \n) (tots els d\351us van gats \n)]
 %% ( \n)  %% l'hem detectat i eliminat
% [(Oh serra mamerra \n) (ens roben la terra \n) (i ens fonen l'aram.)]
%]





  %% pel que fa a incrustar la Courier d'IBM és equivalent a -dPDFSETTINGS=/prepress (estalviant efectes secundaris)
  <<  %% caldria saber si tots tres paràmetres són crítics
    /AlwaysEmbed [/Courier]
    /NeverEmbed []
    /EmbedAllFonts true
    /AutoRotatePages /None
  >>setdistillerparams

  /BeginEPSF
  {
   /b4_Inc_state save def
   /dict_count countdictstack def
   /op_count count 1 sub def
   userdict begin
   /showpage {} def
   /setpagedevice {pop} def  % NOU ! servira per .ps amb pagina configurada ?
   /erasepage {} def  % NOU! (06.98) test de .PS de Quark
   %/statusdict {5 dict} def  % NOU! PageMaker 5.0 (hem de trobar una altra solucio)
   0 setgray 0 setlinecap
   1 setlinewidth 0 setlinejoin
   10 setmiterlimit [] 0 setdash newpath
   /languagelevel where
   {
    pop languagelevel 1 ne
    {
     false setstrokeadjust false setoverprint
    }if
   }if
  }bind def

  /EndEPSF
  {
   count op_count sub
   {
    pop
   }repeat
   countdictstack dict_count sub
   {
    end
   }repeat
   b4_Inc_state restore
  }bind def

  /aPortada[]def  %% hi posarem 3 strings del text, una a sota l'altre, per la portada

% (plegaVeu_OC.ps) (r) file cvx exec
%  strctr
[
 [(Una polla xica, pica, pellarica, camatorta i becarica va tenir sis polls xics, pics, pellarics, camacurts i becarics.)
]
 [
(Si la polla no hagués sigut xica, pica, pellarica, camatorta i becarica, els sis polls no haguessin sigut xics, pics, pellarics, camacurts i becarics.)
]
]

 dup length
  %% agafem aleatoriament un tram de text de fins a 3 mots
  realtime srand  % posem la llavor de l'aleatori
  rand exch mod get dup length
  realtime srand  % posem la llavor de l'aleatori
  rrand exch mod get
  mark exch  %% per netejar sobrers
  3
  {
   ( ) search
   {
    aPortada length dup /araVa exch def 1 add array dup 0 aPortada putinterval
    dup 3 -1 roll araVa exch put /aPortada exch def pop
%aPortada(--------)pstack quit
   }
   {

aPortada length dup /araVa exch def 1 add array dup 0 aPortada putinterval
    dup 3 -1 roll araVa exch put /aPortada exch def
%aPortada(quefem?)pstack quit
    exit  %% i sortim!
   }ifelse
  }repeat

counttomark 0 ne  %% netegem sobrers?
{
 cleartomark
}
{
 pop  %% ens carreguem la mark
}ifelse

  %% mètrica fixa per la Patufet-Mono-Mig-Italic.otf i Patufet-Mono-Mig.otf... 1/1000 = 600
  %% quina és la paraula més llarga de les 3?
  0 dup /lpml exch def aPortada
  {
   length dup lpml gt
   {
    /lpml exch def
    dup /idlpml exch def 1 add
   }
   {
    pop 1 add
   }ifelse
  }forall
  pop

%(\n ..........m'hauries de veure només 1 cop...........\n)pstack quit  %%print flush

  (Patufet-Mono-Mig-Italic.otf)
  %% Courier Medium d'IBM
  %(/Users/femfum/elageminada/Courier_Cat/COM_____.PFB)
  %(/Users/femfum/calaixDtipus/Rousselot/Despeinada.otf)
  %(/Users/femfum/ArtistesDeLaRepublica/Tipografies_JordiEmbodas/Order-0000000226/Bulo-Black.otf)
  findfont dup length dict begin
  {
   1 index /FID ne {def}{pop pop}ifelse
  }forall
  /Encoding
  %% exclusiu de GS
  systemdict /EncodingDirectory get /WinAnsiEncoding get
  %% ISOLatin1Encoding
  %% per personalitzar el xifrat a d'altres caràcters
%  dup length array copy dup 0 /ll put  %% l·l / només per a la Courier d'IBM
%  dup 1 /LL put  %% L·L / només per a la Courier d'IBM
%  dup 2 /tab put  %% triangle a la dreta / només per a la Courier d'IBM
%  dup 3 /center put  %% romb / només per a la Courier d'IBM
  def
  currentdict end
  /laLlatinaI exch definefont pop

  (Patufet-Mono-Mig.otf)
  findfont dup length dict begin
  {
   1 index /FID ne {def}{pop pop}ifelse
  }forall
  /Encoding
  %% exclusiu de GS
  systemdict /EncodingDirectory get /WinAnsiEncoding get
  def
  currentdict end
  /laLlatinaR exch definefont pop
 }if  %% només 1 cop

 [
  null  %% 0

  {  %% 1
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SEMPRE FAS PORTADA\n\n)print flush
   (VanDeGraaf3_plegaVeu.ps) (r) file cvx exec
   4ArtBox  %% array amb els valors de la taca de la pàgina
   dup 0 get exch 2 get aload pop 3 -1 roll aload pop 4 -1 roll 3 -1 roll sub /Pample exch def  %% ample text portada
   sub /Palt exch def  %% alt text portada

   Pample
   %% amb la paraula més llarga, calculem el cos per tal ens quadri amb l'ample de l' /4ArtBox
   aPortada idlpml get length  %% amb la Patufet tots els caràcter fan el mateix
   div  %% per omplir tot /Pample cada caràcter hauria de fer d'ample
   1000 mul 600 div /cPrtd exch def %% doncs aquest és el cos
   %% no fos que ens superés l'Y de Palt?
   aPortada length cPrtd mul Palt gt
   {  %% llavors el cos és
    Palt aPortada length div /cPrtd exch def %% doncs aquest és el cos
   }if
   %% pintem la portada
   gsave
   0 0 0 setrgbcolor
 
   /laLlatinaI cPrtd selectfont
   4ArtBox 1 get aload pop translate
   aPortada length 1 sub 0 exch 1 exch 
   {
    dup 0 exch cPrtd mul cPrtd add neg moveto
    aPortada exch get show
   }for

%(//////)pstack quit
   grestore
  }

  {  %% 2
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA ESQUERRA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 3
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA DRETA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 4
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA ESQUERRA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 5
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA DRETA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 6
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA ESQUERRA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 7
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA DRETA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 8
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   M2 4 eq
   {
    ( <<----- ETS 4+4 i FAS CONTRAPORTADA orientada en,,, )print flush Hrtzntl == (\n\n)print flush
    gsave
    (capAnunciPlegaVeu_967x362.jpeg)
    xPagina
%(xPg4?)pstack quit
 dup 362 mul 967 div dup 3 1 roll yPagina exch sub 0 exch dup /yTxt exch def translate
%(mmmmm)pstack quit
    (NouLectorDeJPEGs5.ps) (r) file
    cvx exec
    grestore
    BeginEPSF
    xPagina 90 sub 20 translate
    1 1 scale  %% Public Domain
    (Public_Domain_Mark_button.eps)
    (r) file cvx exec
    gsave
    0 0 0 setrgbcolor
    12 /cosCrdts exch def
    /laLlatinaI cosCrdts selectfont
    (Plega-Cus-Talla) stringwidth pop cosCrdts 4 mul add neg cosCrdts moveto
    (Plega-Cus-Talla) show
    grestore 
    EndEPSF
    %% text centrat
    gsave
    0 0 0 setrgbcolor
    %%Dada 6 a 4Banderes.ps
    (Recuperem la literatura de canya i cordill que va popularitzar la lectura en els segles posteriors a la invenció de la impremta, la passem pel sedàs de les tecnologies digitals i d'Internet i la retornem al paper imprès. Aquest PliegO utilitza obres literàries que estan al domini públic. Sou lliures de reproduir-lo o crear-ne obres derivades mencionant-ne l'autoria.)
    %%Dada 5 a 4Banderes.ps
    xPagina 90 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 90 sub
    70  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    45  %% offset X
    %%Dada 2 a 4Banderes.ps
    5 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaI COs selectfont
    (4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (AUTORIES)
    xPagina 90 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 90 sub
    285  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    45  %% offset X
    %%Dada 2 a 4Banderes.ps
    9 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaR COs selectfont
    (4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
%%    (Isabel Vila i Pujol, Teresa Claramunt i Creus, María Cambrils Sendra, Francesca Vidal i Tous, Trinitat Aldrich i de Pagès, Joaquima Santamaria i Ventura, Agnès Armengol i Altayó.)
    (Maria Josepa Massanés, Clemencia Isaura, Trinitat Aldrich, Agnès Armengol i Altayó, Dolors Montserdà i Vidal, Emily Dickinson, Ariadna Torres, anònimes i populars.)
    xPagina 90 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 90 sub
    241  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    45  %% offset X
    %%Dada 2 a 4Banderes.ps
    7 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaI COs selectfont
    (4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (RECITEN)
    xPagina 90 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 90 sub
    210  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    45  %% offset X
    %%Dada 2 a 4Banderes.ps
    9 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaR COs selectfont
    (4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (Lia Montalvo i Ramon Fontdevila)
    xPagina 90 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 90 sub
    196  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    45  %% offset X
    %%Dada 2 a 4Banderes.ps
    7 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaI COs selectfont
    (4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (EQUIP PliegOS)
    xPagina 90 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 90 sub
    165  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    45  %% offset X
    %%Dada 2 a 4Banderes.ps
    9 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaR COs selectfont
    (4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (Mònica Garriga, David Gómez Fontanills, Marcantoni Malagarriga-Picas, Enric Senabre, Ariadna Torres)
    xPagina 90 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 90 sub
    131  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    45  %% offset X
    %%Dada 2 a 4Banderes.ps
    7 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaI COs selectfont
    (4Banderes.ps)
    (r) file cvx exec
    grestore
   }
   {
    ( <<----- ETS 8+8 i vas SOLA O BANDA ESQUERRA D'UNA DOBLE PÀGINA\n\n)print flush
   }ifelse
  }

  {  %% 9
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA DRETA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 10
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA ESQUERRA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 11
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA DRETA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 12
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA ESQUERRA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 13
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA DRETA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 14
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA ESQUERRA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 15
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SOLA O BANDA DRETA D'UNA DOBLE PÀGINA\n\n)print flush
  }

  {  %% 16
   (\n) print flush
   Npgn print flush  %% el núm de pàgina és una string
   ( <<----- SI ETS 8+8 FAS CONTRAPORTADA orientada en...)print flush (\n\n)print flush

   gsave
   (/Users/femfum/PliegOS/Cultura/feinaFetaProjectePlegaVeu/capAnunciPlegaVeu_967x362.jpeg)
   xPagina

%(xPg8?)pstack quit
 dup 362 mul 967 div dup 3 1 roll yPagina exch sub 0 exch dup /yTxt exch def translate
%(mmmmm)pstack quit
   (/Users/femfum/PliegOS/codi_pliegOS/NouLectorDeJPEGs5.ps) (r) file
   cvx exec
   grestore
   BeginEPSF
   xPagina 90 sub 20 translate
   1 1 scale  %% Public Domain
   (/Users/femfum/PliegOS/Cultura/feinaFetaProjectePlegaVeu/Public_Domain_Mark_button.eps)
   (r) file cvx exec
   gsave
   0 0 0 setrgbcolor
   8 /cosCrdts exch def
   /laLlatinaI cosCrdts selectfont
   (Plega-Cus-Talla) stringwidth pop cosCrdts 2.5 mul add neg cosCrdts 1.5 mul moveto
   (Plega-Cus-Talla) show
   grestore 
   EndEPSF
    %% text centrat
    gsave
    0 0 0 setrgbcolor
    %%Dada 6 a 4Banderes.ps
    (Recuperem la literatura de canya i cordill que va popularitzar la lectura en els segles posteriors a la invenció de la impremta, la passem pel sedàs de les tecnologies digitals i d'Internet i la retornem al paper imprès. Aquest PliegO utilitza obres literàries que estan al domini públic. Sou lliures de reproduir-lo o crear-ne obres derivades mencionant-ne l'autoria.)
    %%Dada 5 a 4Banderes.ps
    xPagina 60 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 60 sub
    55  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    30  %% offset X
    %%Dada 2 a 4Banderes.ps
    3.3 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaI COs selectfont
    (/Users/femfum/PliegOS/Cultura/feinaFetaProjectePlegaVeu/4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (AUTORIES)
    xPagina 60 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 60 sub
    190  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    30  %% offset X
    %%Dada 2 a 4Banderes.ps
    6 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaR COs selectfont
    (/Users/femfum/PliegOS/Cultura/feinaFetaProjectePlegaVeu/4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (Isabel Vila i Pujol, Teresa Claramunt i Creus, María Cambrils Sendra, Francesca Vidal i Tous, Trinitat Aldrich i de Pagès, Joaquima Santamaria i Ventura, Agnès Armengol i Altayó.)
    xPagina 60 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 60 sub
    160.6  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    30  %% offset X
    %%Dada 2 a 4Banderes.ps
    4.6 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaI COs selectfont
    (/Users/femfum/PliegOS/Cultura/feinaFetaProjectePlegaVeu/4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (RECITEN)
    xPagina 60 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 60 sub
    140  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    30  %% offset X
    %%Dada 2 a 4Banderes.ps
    6 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaR COs selectfont
    (/Users/femfum/PliegOS/Cultura/feinaFetaProjectePlegaVeu/4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (Lia Montalvo i Ramon Fontdevila)
    xPagina 60 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 60 sub
    130.6  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    30  %% offset X
    %%Dada 2 a 4Banderes.ps
    4.6 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaI COs selectfont
    (/Users/femfum/PliegOS/Cultura/feinaFetaProjectePlegaVeu/4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (EQUIP PliegOS)
    xPagina 60 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 60 sub
    110  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    30  %% offset X
    %%Dada 2 a 4Banderes.ps
    6 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaR COs selectfont
    (/Users/femfum/PliegOS/Cultura/feinaFetaProjectePlegaVeu/4Banderes.ps)
    (r) file cvx exec
    grestore
    gsave
    0 0 0 setrgbcolor
    (Mònica Garriga, David Gómez Fontanills, Marcantoni Malagarriga-Picas, Enric Senabre, Ariadna Torres)
    xPagina 60 sub
    %%Dada 4 a 4Banderes.ps
    xPagina 60 sub
    92  %% altura del sota Y
    %%Dada 3 a 4Banderes.ps
    30  %% offset X
    %%Dada 2 a 4Banderes.ps
    4.6 /COs exch def
    %%Dada 1 a 4Banderes.ps
    /laLlatinaI COs selectfont
    (/Users/femfum/PliegOS/Cultura/feinaFetaProjectePlegaVeu/4Banderes.ps)
    (r) file cvx exec
    grestore
  }
 ]

 Npgn cvx exec get cvx exec  %% el núm. de pàgina fa d'index d'execució
  
}if  %% comportament null: anellat del codi que pinta contingut de pàgina

%% prohibit fer servir showpage!
